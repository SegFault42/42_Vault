/*
   * Copyright 2011, Tobias Lindig
   *
   * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
   * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
   *
   */

(function(){define("quests",[],function(){var e;return e=function(){function e(){var e,t,n,r,i,a,o,s;for(n=this,t=[],s=$("[data-hide-unless-form]"),r=0,a=s.length;a>r;r++)e=s[r],t.push($("form #"+e.dataset.hideUnlessForm));for(i=0,o=t.length;o>i;i++)e=t[i],e.on("change",n.hideForms),e.trigger("change")}return e.prototype.hideForms=function(){return""===$(this).val()?$("[data-hide-unless-value]").closest(".form-group").show():($("[data-hide-unless-form="+$(this).attr("id")+"]").closest(".form-group").hide(),$("[data-hide-unless-value~="+$(this).val()+"]").closest(".form-group").show())},e}()})}).call(this),function(){define("project/answer",["jquery"],function(e){var t;return t=function(){function t(){e(document).on("change","[data-star-range]",function(){return e(this).attr("data-star-range",e(this).val())})}return t}()})}.call(this),function(){define("project/calendar",["jquery","noty","fullcalendar"],function(e){var t;return t=function(){function t(){var t;t=this,this._$modal=e("#slotSelectionModalContainer"),this._$calendar=e("#calendar"),this._$loading=e("#loading"),this._waitingAjax=!1,this.calendar=this._$calendar.fullCalendar({header:{left:"",center:"title",right:"today prev next"},axisFormat:"h:mm a",defaultDate:moment(),defaultView:"agendaWeek",firstDay:1,allDaySlot:!1,slotEventOverlap:!1,selectable:!1,selectHelper:!0,slotDuration:"00:30:00",snapDuration:"00:15:00",eventClick:function(e){return function(n){var r;if(!e._waitingAjax)return r=n.ids.split(",").map(function(e){return e>>0}),t._populateModal(r,n),t._$modal.modal("show")}}(this),loading:function(e){return function(t){return e._isLoading=t,e._isLoading?(e._intervalHandler=clearInterval(e._intervalHandler),e._timeOutHandler=setTimeout(function(){return e._loadingEnable=!0,e._$loading.show(),e._intervalHandler=setInterval(function(){return e._isLoading?void 0:(e._$loading.fadeOut(),e._loadingEnable=!1,e._intervalHandler=clearInterval(e._intervalHandler))},1e3)},100)):e._loadingEnable?void 0:clearTimeout(e._timeOutHandler)}}(this),events:function(n,r,i,a){var o;return o={start:n.format(),end:r.format()},e.getJSON(t._$calendar.data("index-url"),o,function(e){return a(e)})}}),this._bind()}return t.prototype._bind=function(){return this._$modal.on("hidden.bs.modal",".btn-primary",function(){return e(this).off(".modal")}),this._$modal.on("click.modal",".btn-primary:not(.disable)",this._sendSelectedSession.bind(this))},t.prototype._sendSelectedSession=function(){var t,n,r,i;return t=this._$modal.find(".modal-body select"),r=t.val()>>0,n=t.data("ids").split(",").slice(r,r+this._$calendar.data("duration")).join(","),i=this._$calendar.data("update-url").replace(":ids",n),this._waitingAjax=!0,this._$loading.show(),this._$modal.find(".btn-primary").addClass("disable"),e.ajax({url:i,type:"post",dataType:"json",data:{start:this._$calendar.fullCalendar("getView").start.format(),end:this._$calendar.fullCalendar("getView").end.format(),_method:"put"},success:function(e){return function(t){return 200===t.status?document.location=e._$calendar.data("reload-url"):void 0}}(this),complete:function(e){return function(t){return e._showNotification(t),e._$loading.fadeOut(),e._waitingAjax=!1}}(this),error:function(e){return function(){return e._$modal.find(".btn-primary").removeClass("disable")}}(this)})},t.prototype._populateModal=function(t,n){var r,i,a,o,s,l,u;for(s=moment(n._start),o=this._$calendar.data("duration"),l=15,r=this._$modal.find(".modal-body select"),r.empty(),a=t.length-o,i=u=0;a>=0?a>=u:u>=a;i=a>=0?++u:--u)r.append(e('<option value="'+i+'"> From '+n._start.format("LT")+" to "+n._start.add(l*o,"m").format("LT")+" </option>")),n._start.subtract((o-1)*l,"m");return n._start=s,r.data("ids",t.join(","))},t.prototype._showNotification=function(e){return e=e.responseJSON?e.responseJSON:{status:500,message:"Error"},noty({layout:"topRight",type:200===e.status?"success":"error",text:e.message,timeout:4e3})},t}(),t.isCalendar=function(){return e("#calendar").length},t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/list",["lodash","vendor/list"],function(t,n){var r;return r=function(){function r(){this._sort=e(this._sort,this),this.options={valueNames:t.map(i,function(e){return"project-"+e}),sortFunction:this._sort},this.projectsList=new n(a,this.options),this._bindSearch(),this._bindFilters()}var i,a;return i=["name","duration","recommendation","registration"],a="projects-list-container",r.prototype._bindSearch=function(){var e;return e=document.getElementsByClassName("projects-list--search")[0],e?e.addEventListener("keyup",function(t){return function(){return t.projectsList.search(e.value,["project-name"])}}(this)):void 0},r.prototype._bindFilters=function(){var e,t,n,r,i,a;if(e=document.getElementsByClassName("projects-list--header")[0]){for(i=e.getElementsByClassName("filter-trigger"),a=[],n=0,r=i.length;r>n;n++)t=i[n],a.push(t.addEventListener("click",this._filter(t)));return a}},r.prototype._escapeValue=function(e){return t.snakeCase(t.trim(t.deburr(e)))},r.prototype._cmp=function(e,t){var n;return"project-duration"===t?parseInt(e.elm.attributes.getNamedItem("data-"+t.slice(8)).value):(n=e.elm.attributes.getNamedItem("data-"+t.slice(8)),(n?n.value:"_")+e.elm.attributes.getNamedItem("data-name").value)},r.prototype._sort=function(e,t,n){var r;return r="asc"===n.order?1:-1,this._cmp(e,n.valueName)<this._cmp(t,n.valueName)?-1*r:this._cmp(e,n.valueName)>this._cmp(t,n.valueName)?1*r:0},r.prototype._filter=function(e){return function(n){return function(r){var i,a,o,s,l;if(e.classList.contains("active"))return e.classList.remove("active"),e.parentElement.getElementsByClassName("filter-trigger")[0].classList.add("active"),n.projectsList.filter(n._filterClear);for(l=e.parentElement.getElementsByClassName("filter-trigger"),o=0,s=l.length;s>o;o++)a=l[o],a.classList.remove("active");return e.classList.add("active"),i=n["_filter"+t.capitalize(t.camelCase(e.attributes.getNamedItem("data-filter").value))],n.projectsList.filter(i)}}(this)},r.prototype._filterRecommendedProjects=function(e){return"a_recommended"===e.elm.attributes.getNamedItem("data-recommendation").value&&"znot_registered"===e.elm.attributes.getNamedItem("data-registration").value},r.prototype._filterClear=function(e){return!0},r.isProjectsList=function(){return null!=document.getElementById(a)},r}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/scales",["jquery","rangeslider"],function(t){var n;return n=function(){function n(){this._onSkillIdChange=e(this._onSkillIdChange,this),this._onQuestionKindChange=e(this._onQuestionKindChange,this),this._sliderSlt='input[type="range"]',this._skillSummaryCtnSlt=".skillSummary",this._typeInputInputSlt="[data-skill-type]",this._questionKindInputSlt="[data-question-kind]",this._addSkillStl="[data-association='questions_skills'].add_nested_fields",this._getSummarySkills(),this._createSliders(),this._bind(),t(""+this._sliderSlt).parents(".form-group").show(),this._updateLimits(),this._updateSummary()}return n.prototype._createSliders=function(){var e;return e=this,t(""+this._sliderSlt).not(".slided").each(function(e){return function(n,r){var i,a;return i=t(r),a=i.data("kind"),i.attr("max","standard"===a?100:25),i.rangeslider({polyfill:!1,onSlide:function(){return e._checkLimit.apply(e,t.merge(arguments,this.$element))},onSlideEnd:function(){return e._updateLimits(),e._updateSummary()}}),i.addClass("slided")}}(this))},n.prototype._bind=function(){return t(document).on("change",this._questionKindInputSlt,this._onQuestionKindChange),t(document).on("change",this._typeInputInputSlt,this._onSkillIdChange),t(document).on("nested:fieldRemoved",function(e){return function(){return e._updateLimits(),e._updateSummary()}}(this)),t(document).on("nested:fieldAdded:questions",function(e){return function(t){return t.field.find(""+e._questionKindInputSlt).change()}}(this)),t(document).on("nested:fieldAdded:questions_skills",function(e){return function(){var n,r;return n=t(""+e._sliderSlt).not(".slided"),r=n.parents(".fields:eq(1)").find(""+e._questionKindInputSlt).val(),n.data("kind",r),e._createSliders(),n.parents(".fields:eq(0)").find("[data-skill-type]").change()}}(this))},n.prototype._onQuestionKindChange=function(e){var n,r,i;return i=t(e.currentTarget),r=i.parents(".fields").first(),n=r.find(""+this._sliderSlt),n.data("kind",i.val()),n.val(0),n.rangeslider("destroy").removeClass("slided"),this._createSliders(),this._updateLimits(),this._updateSummary()},n.prototype._onSkillIdChange=function(e){var n,r,i,a;return n=t(e.currentTarget),a=n.val(),i=n.parents(".form-group").next(),r=i.find(""+this._sliderSlt),a?(i.fadeIn("slow"),r.attr("data-slider-id",a)):i.fadeOut("slow"),r.val(0),this._updateLimits(),a&&r.val(r.data("slider-limit")).change(),this._updateLimits(),this._updateSummary()},n.prototype._checkLimit=function(e,n,r){var i;return t(r).next().find(".rangeslider__handle").html(""+n),i=t(r).data("slider-limit"),n>i?t(r).val(i).change():void 0},n.prototype._updateLimits=function(){var e;return e=this._getUniqSliders(),e.each(function(e){return function(n,r){var i,a,o,s,l,u;return a=t(r).attr("data-slider-id"),o=t(r).data("kind"),l=t(r).attr("max")>>0,u=t(r).attr("min")>>0,i=t(""+e._sliderSlt+":visible[data-slider-id="+a+"]").filter(function(e,n){return t(n).data("kind")===o}),s=l,i.each(function(e,n){return s-=t(n).val()>>0}),u>s&&(s=u),i.each(function(e,n){return t(n).data("slider-limit",s+(t(n).val()>>0))})}}(this))},n.prototype._getUniqSliders=function(){var e,n;return e=t(""+this._sliderSlt+":visible.slided"),n={standard:[],bonus:[]},e=e.filter(function(e,r){var i,a;return i=t(r).attr("data-slider-id"),a=t(r).data("kind"),-1===n[a].indexOf(i)?(n[a].push(i),!0):!1})},n.prototype._getSummarySkills=function(){return this._summarySkills=t(""+this._skillSummaryCtnSlt+" [data-skill-id]").map(function(e,n){return{id:t(n).attr("data-skill-id"),$element:t(n)}})},n.prototype._updateSummary=function(){return this._summarySkills.each(function(e){return function(n,r){var i,a;return a={standard:0,bonus:0},null!=r.id&&(i=t(""+e._sliderSlt+":visible[data-slider-id="+r.id+"]"),i.each(function(e,n){var r;return r=t(n).data("kind"),a[r]+=t(n).val()>>0})),r.$element.find(".standard .value").html(a.standard),r.$element.find(".bonus .value").html(a.bonus)}}(this))},n}(),n.isScales=function(){return t(".skillSummary").length},n})}.call(this),function(){define("project/radios",["jquery"],function(e){var t;return t=function(){function t(){var t;t=this,e("[data-radio-item] label").each(function(){var n;return n=this,e("#"+e(this).attr("for")).on("change",function(){return t._activate(n)}),e(this).on("click",function(){return t._activate(this)})})}return t.prototype._activate=function(t){var n;return n=e(t).parent().attr("data-radio-item"),e("[data-radio-item='"+n+"'] label").removeClass("active"),e(t).addClass("active"),e(t).hasClass("negative")?e(".scale-section-answers").addClass("hidden"):e(".scale-section-answers").removeClass("hidden")},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/rules",["jquery","typeahead"],function(t){var n,r;return r=/(([^ ,]|\\ )*)$/,n=function(){function n(){this.changed=e(this.changed,this),this._completion_url=t("form .autocomplete").data("completion-url"),this._save="",this._setBloodhound(),this._bindAutoComplete(t("form .autocomplete")),this.url=t("[data-select-url]").data("select-url"),t(".rules_select").each(function(){return 0===t(this).find("option:checked").attr("value").length?t(this).parents(".form-group").siblings(".params_fields").html(""):void 0}),t("form").on("change",".rules_select",function(e){return function(t){return e.changed(t.target)}}(this))}return n.prototype._bindAutoComplete=function(e){return e.typeahead({highlight:!1,hint:!1},{display:"value",source:this.bloodhound.ttAdapter(),templates:{suggestion:function(e){return"<p><span class='label label-primary'> "+e.cat+" </span> &nbsp; "+e.value+"</p>"}},updater:function(e){return this.$element.val().replace(/[^,]*$/,"")+e+", "}}),e.on("typeahead:active, typeahead:idle",function(e){return function(n){return t(n.currentTarget).val()?t(n.currentTarget).val(e._value):void 0}}(this)),e.on("typeahead:render",function(e){return function(n){return e._value=t(n.currentTarget).val()}}(this)),e.on("typeahead:cursorchange",function(e){return function(n,i){return e._value=e._value.substring(0,r.exec(e._value).index),e._value+=i?i.value:"",t(n.currentTarget).val(e._value)}}(this)),e.on("typeahead:select",function(e){return function(n,i){return setTimeout(function(){return e._value=e._value.substring(0,r.exec(e._value).index),e._value+=i?i.value:"",t(n.currentTarget).val(e._value)},0)}}(this)),e.on("typeahead:change",function(e){return function(n){return setTimeout(function(){return t(n.currentTarget).val()?t(n.currentTarget).val(e._value):void 0},0)}}(this))},n.prototype._setBloodhound=function(){return this.bloodhound=new Bloodhound({datumTokenizer:function(e){return Bloodhound.tokenizers.whitespace(e.displayKey)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:this._completion_url+"?query=%QUERY",wildcard:"%QUERY",prepare:function(e,t){return e=e.substring(r.exec(e).index),t.url=t.url.replace("%QUERY",encodeURIComponent(e)),t},transform:function(e){var t;return t=[],_.forIn(e,function(e,n){return _.each(e,function(e){return t.push({value:e,cat:n})})}),e=t}}}),this.bloodhound.initialize()},n.prototype.changed=function(e){var n,r,i;return n=t(e).parents(".form-group").siblings(".params_fields"),r=function(e){return function(){return n.find(".autocomplete").typeahead("destroy"),n.html("")}}(this),i=function(r){return function(i){return t.getJSON(i,function(i){var a,o;return a=t("<div class='form-group input optional project_projects_rules_rule'></div>"),o=t(e).attr("name"),t.each(i,function(e,t){var n,r;return r=(new Date).getTime(),n="<label class='select optional col-sm-2 control-label' for='project_projects_rules_attributes_params_attributes_"+r+"_rule_id'>"+t.name+"</label>",n+="<div class='col-sm-10'><input class='input optional autocomplete form-control' data-url='http://localhost:9000/completions.json' data-display-key='' value='"+t.default_value.replace(/(')/g,"&#39;")+"' id='project_projects_rules_attributes_params_attributes_"+r+"_value' name='"+o.replace("[rule_id]","[params_projects_rules_attributes]["+r+e+"][value]")+"' /></div>",n+="<div class='col-sm-12'><input class='hidden optional form-control' value='"+t.id+"' name='"+o.replace("[rule_id]","[params_projects_rules_attributes]["+r+e+"][param_id]")+"' /></div>",a.append(n)}),n.replaceWith(a),r._bindAutoComplete(a.find(".autocomplete"))})}}(this),0===t(e).find("option:checked").attr("value").length?r(n):i(this.url.replace(":id",t(e).find("option:checked").attr("value")))},n}(),n.hasRules=function(){return t("[data-select-url]").length},n})}.call(this),function(){define("project/skills",["jquery","rangeslider"],function(e){var t;return t=function(){function t(){e("[data-add-skill]").length&&(this._$form=e("form"),this._rangeSlt='input[type="range"]:visible',this._$difficulty=e("[data-difficulty]"),this._updateLimits(),e(""+this._rangeSlt).each(function(t){return function(n,r){return t._initSlider(e(r))}}(this)),this._$difficulty.on("change",function(t){return function(){return t._updateRanges(e(""+t._rangeSlt))}}(this)),e(document).on("nested:fieldRemoved:projects_skills",function(e){return function(){return e._updateLimits()}}(this)),e(document).on("nested:fieldAdded:projects_skills",function(t){return function(){return t._updateRanges(e(""+t._rangeSlt).not(".slided"))}}(this)))}return t.prototype._updateRanges=function(t){var n,r;return r="0"===e("[data-difficulty]").val()?100:e("[data-difficulty]").val(),n=parseFloat(r),t.each(function(t){return function(r,i){var a,o,s,l;return a=e(i),l=a.attr("max"),s=n*a.val()/l,o=n/100,a.attr("max",n).attr("step",o),a.rangeslider("destroy"),a.val(s),t._initSlider(a),a.val(s)}}(this)),this._updateLimits()},t.prototype._initSlider=function(e){return e.rangeslider({polyfill:!1,onSlide:this._checkLimit,onSlideEnd:function(e){return function(){return e._updateLimits()}}(this)}),e.addClass("slided")},t.prototype._checkLimit=function(t,n){var r,i,a;return a="0"===e("[data-difficulty]").val()?100:e("[data-difficulty]").val(),i=100*n/parseFloat(a),this.$element.next().find(".rangeslider__handle").attr("data-percent",""+i),r=this.$element.data("rangeUntil"),n>r?this.$element.val(r).change():void 0},t.prototype._updateLimits=function(){var t,n;return n="0"===e("[data-difficulty]").val()?100:e("[data-difficulty]").val(),t=parseFloat(n),e(""+this._rangeSlt).each(function(n,r){return t-=parseFloat(e(r).val())}),0>t&&(t=0),e(""+this._rangeSlt).each(function(n,r){return e(r).data("rangeUntil",parseFloat(e(r).val())+t)})},t.prototype.modalCondition=function(){var t;return t=0,e(""+this._rangeSlt).each(function(n,r){return t+=e(r).next().find(".rangeslider__handle").data("percent")>>0}),100!==t&&"0"!==e("[data-difficulty]").val()},t.prototype.modalConfirmation=function(){return this._$form.submit()},t}(),t.hasSkills=function(){return e("[data-add-skill]").length},new t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/form",["jquery","lodash","marked"],function(t,n,r){var i;return new(i=function(){function i(){this._updateSelectSkills=e(this._updateSelectSkills,this),this._getAvailableSkills=e(this._getAvailableSkills,this),this._getValuesSelectSkillInputs=e(this._getValuesSelectSkillInputs,this),t(".new_project, .edit_project").length>0&&this._bindProject(),t(".new_scale, .edit_scale").length>0&&this._bindScale()}return i.prototype._bindProject=function(){return this._bindNameCheck(),this._hideDependancies(),this._bindEstimations(),this._bindRules(),this._initRules(),this._updateSelectSkills(),t(document).on("change",".project_projects_skills_skill select",this._updateSelectSkills),t(document).on("nested:fieldAdded",this._updateSelectSkills),t(document).on("nested:fieldRemoved",this._updateSelectSkills),t("#project_cursus_ids").change(this._updateSelectSkills)},i.prototype._bindNameCheck=function(){var e;return e=this,t("#project_name").keyup(function(){var r,i;return r=t(this),t(this).val().length>0?(i=t(this).val(),t.getJSON(""+location.origin+"/projects.json",function(t){var a;return a=n.findWhere(t,{name:i}),a?(e._updateNextHelp(r,""+i+" is already taken"),e._updateNextHelp("#project_tag_ids","")):(e._updateNextHelp(r,""+i+" seems to be a nice name !"),e._updateNextHelp("#project_tag_ids","The tag "+i+" will also be automaticaly created."))})):(e._updateNextHelp(r,""),e._updateNextHelp("#project_tag_ids",""))})},i.prototype._bindEstimations=function(){return t("#project_estimate_time").val("604800")},i.prototype._initRules=function(){return t(".rules_select").each(this._setRuleTemplate)},i.prototype._bindRules=function(){return t(document).on("change",".rules_select",this._setRuleTemplate)},i.prototype._setRuleTemplate=function(){var e,r,i;return r=n.template("<div class=\"col-sm-12 lead\">\n  <h4><%= kind.toUpperCase() %>: Rule <%= name %>\n    <small>\n      <%= description || 'No description' %>\n    </small>\n  </h4>\n</div>"),e=t(this).parents(".fields").find(".rule-description").first(),i=n.findWhere(rules_description,{id:parseInt(t(this).val())}),e.html(r(i))},i.prototype._hideDependancies=function(){return""===t("#project_parent_id").val()&&t(".project_inherited_team").hide(),t("#project_parent_id").change(function(){return""!==t(this).val()?t(".project_inherited_team").show():t(".project_inherited_team").hide()})},i.prototype._updateNextHelp=function(e,n){var r;return r=t(e).parent().find(".help-block").last(),t(r).length>0?t(r).html(n):void 0},i.prototype._bindScale=function(){return this._bindMarkdownPreviews(),this._checkScales(),this._bindNavbarArchi(),t(document).on("nested:fieldAdded",function(e){return function(){return e._bindNavbarArchi()}}(this)),t(".section-counter-item input[type='text']").keyup(function(e){return function(){return e._bindNavbarArchi()}}(this))},i.prototype._checkScales=function(){var e,r;return e=n.template("<p class='text-warning primary-warning'>An other scale (<%= name %>) is already set as <b>primary</b>. You can <a href='<%= link %>/edit' target='_blank'>edit it now</a></p>"),r=n.template("<p class='text-warning primary-warning'>There is no other scale defined as primary for this project. Don't forget to set this scale as primary later if you want to use it for defenses.</a></p>"),existing_scales&&t("#scale_is_primary").parents(".checkbox").after(e(existing_scales)),t("#scale_is_primary").change(function(){var n;return n=this.checked,t(".primary-warning").detach(),n&&existing_scales?t("#scale_is_primary").parents(".checkbox").after(e(existing_scales)):n||existing_scales?void 0:t("#scale_is_primary").parents(".checkbox").after(r())})},i.prototype._bindMarkdownPreviews=function(){return t("[data-markdown-preview]").each(function(e){var n;return n=t("<div class='markdown-preview-container'></div>"),t(this).after(n),t(this).keyup(function(){return t(n).html(r(t(this).val()))})})},i.prototype._bindNavbarArchi=function(){var e;return e=t("#navbar-scale-edit .nav .sections-list"),e.html("<li><h5 class='marked-title'><a href='#sections'>Sections <small>("+t(".section-counter-item").length+" defined)</small></a></h5><ol class='section-root'></ol></li>"),t(".section-counter-item").each(function(){var n,r,i;return i=t(this).find(".scale_sections_name input"),n=t("<li><a href='#"+i.attr("id")+"'>"+i.val()+"</a></li>"),t(this).find(".question-item").length>0&&(r=t("<ol></ol>"),t(this).find(".question-item").each(function(){var e,n;return n=t(this).find(".scale_sections_questions_name input"),e=t("<li><a href='#"+n.attr("id")+"'>"+n.val()+"</a></li>"),r.append(e)}),n.append(r)),e.find(".section-root").append(n)})},i.prototype._getValuesSelectSkillInputs=function(){return n.map(t(".fields:visible .project_projects_skills_skill select.chosen"),function(e){return parseInt(t(e).val(),10)})},i.prototype._getAvailableSkills=function(){var e,r;return e=t("#project_cursus_ids").val()||[],r=n.map(e,function(e){return available_skills[parseInt(e,10)]}),n.merge.apply(n,r)},i.prototype._updateSelectSkills=function(){var e,r;return e=this._getValuesSelectSkillInputs(),(r=this._getAvailableSkills())?(r=n.without(r,e),t(".fields:visible .project_projects_skills_skill select.chosen").each(function(e,n){return t(n).children(":not(:selected)").each(function(e,n){var i;return i=parseInt(t(n).val(),10),t(n).prop("disabled",-1===r.indexOf(i))}),t(n).trigger("chosen:updated")})):void 0},i}())})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/sort",["jquery","Sortable","noty"],function(t,n,r){var i;return i=function(){function i(){this._update=e(this._update,this);var r;this.sortables=[],r=this._update,t("ul[data-sortable]").each(function(e){return function(i,a){var o,s,l;return o=t(a),l=o.data("group"),s={group:l,onUpdate:function(){return r(o.data("update-url"),l,this.toArray())}},e.sortables.push(new n(a,s))}}(this))}return i.prototype._update=function(e,n,i){var a;return a={},a[n]=i,t.post(e,a,function(e){return function(){return r({layout:"topRight",type:"success",text:"Updated",timeout:4e3})}}(this))},i}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("project/projectuserlist",["lodash","vendor/list"],function(t,n){var r;return r=function(){function r(){this._sort=e(this._sort,this),this.options={valueNames:i,sortFunction:this._sort,page:500},this.projectUserList=new n(a,this.options),this._bindSearch(),this._bindFilters()}var i,a;return i=["project-user--user","project-user--startedat","project-user--mark"],a="projectuser-list-container",r.prototype._bindSearch=function(){var e;return e=document.getElementsByClassName("projects-list--search")[0],e?e.addEventListener("keyup",function(t){return function(){return t.projectUserList.search(e.value,["project-user--user","project-user--mark"])}}(this)):void 0},r.prototype._bindFilters=function(){var e,t,n,r,i,a;if(e=document.getElementsByClassName("projects-list--header")[0]){for(i=e.getElementsByClassName("filter-trigger"),a=[],n=0,r=i.length;r>n;n++)t=i[n],a.push(t.addEventListener("click",this._filter(t)));return a}},r.prototype._filter=function(e){return function(n){return function(r){var i,a,o,s,l;if(e.classList.contains("active"))return e.classList.remove("active"),e.parentElement.getElementsByClassName("filter-trigger")[0].classList.add("active"),n.projectUserList.filter(n._filterClear);for(l=e.parentElement.getElementsByClassName("filter-trigger"),o=0,s=l.length;s>o;o++)a=l[o],a.classList.remove("active");return e.classList.add("active"),i=n["_filter"+t.capitalize(t.camelCase(e.attributes.getNamedItem("data-filter").value))],n.projectUserList.filter(n._filterProjectUserList)}}(this)},r.prototype._escapeValue=function(e){return t.snakeCase(t.trim(t.deburr(e)))},r.prototype._cmp=function(e,t){return e.elm.attributes.getNamedItem("data-"+t).value+e.elm.attributes.getNamedItem("data-pu-user").value},r.prototype._sort=function(e,t,n){var r;return r="asc"===n.order?1:-1,this._cmp(e,n.valueName)<this._cmp(t,n.valueName)?-1*r:this._cmp(e,n.valueName)>this._cmp(t,n.valueName)?1*r:0},r.prototype._filterProjectUserList=function(e){var t;return t=$(".filter-trigger.active").data("filter"),t&&"clear"!==t?e.elm.attributes.getNamedItem("data-status").value===t:!0},r.prototype._filterClear=function(e){return!0},r.isProjectUserList=function(){return null!=document.getElementById(a)},r}()})}.call(this),function(){define("project/main",["require","jquery","project/answer","project/calendar","project/list","project/scales","project/radios","project/rules","project/skills","project/form","project/sort","project/projectuserlist","components"],function(e,t,n,r,i,a,o,s,l,u,c,d){var p;return p=function(){function e(){a.isScales()&&new a,r.isCalendar()&&new r,s.hasRules()&&new s,new n,new o,i.isProjectsList()&&new i,d.isProjectUserList()&&new d,new c}return e}()})}.call(this),define("project",["project/main"],function(e){return e}),function(){define("graph/colors",[],function(){return{grid:{fill:"#19191e"},unavailable:{fill:"#46484c",stroke:"#6f7278",strokeSize:3,text:"#6f7278",link:"#666666"},available:{fill:"#46464c",stroke:"white",strokeSize:10,text:"white",link:"white"},done:{fill:"#00BABC",stroke:"#00BABC",strokeSize:10,text:"white",link:"#00BABC"},fail:{fill:"#cc6256",stroke:"#cc6256",strokeSize:3,text:"white",link:"#cc6256"},in_progress:{fill:"#46464c",stroke:"#00BABC",strokeSize:3,text:"#00BABC",link:"#00BABC"}}})}.call(this),function(){define("graph/grid",["paper","./colors"],function(e,t){return{draw:function(t,n,r){return t.activate(),new e.Path.Rectangle({from:[0,0],to:[n,r]})}}})}.call(this),function(){define("graph/data",[],function(){return{}})}.call(this),function(){define("graph/styles",["./colors"],function(e){return{unavailable:{strokeColor:e.unavailable.stroke,strokeWidth:3,fillColor:e.unavailable.fill,text:{fontFamily:"Noto Sans",fontWeight:"bold",fontSize:20,fillColor:e.unavailable.text,justification:"center"}},available:{strokeColor:e.available.stroke,strokeWidth:10,fillColor:e.available.fill,text:{fontFamily:"Noto Sans",fontWeight:"bold",fontSize:20,fillColor:e.available.text,justification:"center"}},done:{strokeColor:e.done.stroke,strokeWidth:10,fillColor:e.done.fill,text:{fontFamily:"Noto Sans",fontWeight:"bold",fontSize:20,fillColor:e.done.text,justification:"center"}},fail:{strokeColor:e.fail.stroke,strokeWidth:3,fillColor:e.fail.fill,text:{fontFamily:"Noto Sans",fontWeight:"bold",fontSize:20,fillColor:e.fail.text,justification:"center"}},in_progress:{strokeColor:e.in_progress.stroke,strokeWidth:3,fillColor:e.in_progress.fill,text:{fontFamily:"Noto Sans",fontWeight:"bold",fontSize:20,fillColor:e.in_progress.text,justification:"center"}}}})}.call(this),function(){define("graph/help",["require","exports","module","lodash","jquery","./project","./search"],function(e,t,n){var r,i,a,o,s,l,u;return u=e("lodash"),r=e("jquery"),s=e("./project"),l=e("./search"),i=r("#graph_help"),a=r("#graph_help_icon"),o={show:function(){return l.is_visible()?void 0:(s.unselect(),i.fadeIn("fast"),l.hide())},hide:function(){return this.is_visible()?i.fadeOut("fast"):void 0},toggle:function(e){return function(){return e.is_visible()?e.hide():e.show()}}(this),is_visible:function(){return i.is(":visible")},bind:function(){return a.on("click",this.toggle)}},u.assign(t,o)})}.call(this),function(){define("graph/search",["require","exports","module","lodash","jquery","paper","./data","./project","./description","./help"],function(e,t,n){var r,i,a,o,s,l,u,c,d,p,h;return h=e("lodash"),r=e("jquery"),p=e("paper"),o=e("./data"),u=e("./project"),s=e("./description"),l=e("./help"),a=r("#graph_search.typeahead"),i=r("#graph_search_icon"),d=function(e,t){return u.select(h.filter(o.projects,{project_id:t.value}),!0)},c={show:function(){return s.hide(),l.hide(),a.fadeIn("fast").focus(),i.fadeTo(200,0)},hide:function(){return a.typeahead("val",""),a.fadeOut("fast"),i.fadeTo(200,1)},is_visible:function(){return a.is(":visible")},toggle:function(){return this.is_visible()?this.hide():this.show()},on_escape:function(){return this.is_visible()?0===a.typeahead("val").length?this.hide():a.typeahead("val",""):void 0},bind:function(){return a.on("typeahead:selected",d),i.on("click",this.show)}},h.assign(t,c)})}.call(this),function(){define("graph/description",["require","exports","module","lodash","jquery","./data","./project","./description","./search","./help"],function(e,t,n){var r,i,a,o,s,l,u,c,d,p;return d=e("lodash"),r=e("jquery"),a=e("./data"),l=e("./project"),o=e("./description"),u=e("./search"),s=e("./help"),i=r("#graph_description"),p=d.template(r("script.graph_description_template").html()),c=null,o={show:function(e){var t;return t=d.find(a.projects,{project_id:e}),clearTimeout(c),c=setTimeout(function(){return i.html(p(t)).fadeIn("fast")},200)},hide:function(){return i.fadeOut(0,function(){return i.empty()})},is_visible:function(){return i.is(":visible")},click_on_link:function(){return i.is(":visible")?document.location=i.find(".header > a")[0].href:void 0}},d.assign(t,o)})}.call(this),function(){define("graph/project",["require","exports","module","lodash","paper","./styles","./colors","./data","./description","./search","./zoom_handler","./help"],function(e,t,n){var r,i,a,o,s,l,u,c,d,p,h,f;return f=e("lodash"),h=e("paper"),u=e("./styles"),r=e("./colors"),i=e("./data"),a=e("./description"),l=e("./search"),c=e("./zoom_handler"),o=e("./help"),p=function(e){return"internship"===e.kind.slice(-10)},d=function(e,t){var n;return n=t?{shadowBlur:180*h.view.zoom,shadowColor:r[e.state].stroke,shadowOffset:new h.Point(0,0)}:{shadowBlur:0,shadowColor:null,shadowOffset:null},e.$box.set(n),e.$box_internship&&e.$box_internship.set(n),h.view.draw()},s={draw:function(e,t){var n;return n=t[p(e)?"internship":"project"],n.activate(),e.selected=!1,this["draw_"+e.kind](e,function(n){return function(r){return t.project.activate(),n.draw_label(e),n.set_style(e,r)}}(this))},set_style:function(e,t){return e.$box?e.$box.style=u[e.state]:void 0},draw_first_internship:function(e,t){return e.$box_internship=new h.Path.Circle({center:[e.x,e.y],radius:1e3,style:f.assign(f.cloneDeep(u[e.state]),{fillColor:null})}),t()},draw_second_internship:function(e,t){return e.$box_internship=new h.Path.Circle({center:[e.x,e.y],radius:2200,style:f.assign(f.cloneDeep(u[e.state]),{fillColor:null})}),t()},draw_rush:function(e,t){return e.$box=new h.Path.Rectangle({center:[e.x,e.y],size:new h.Size(120,60),radius:25}),t()},draw_exam:function(e,t){return e.$box=new h.Path.Circle({center:[e.x,e.y],radius:80}),t()},draw_project:function(e,t){return e.$box=new h.Path.Circle({
center:[e.x,e.y],radius:50}),t()},draw_part_time:function(e,t){return e.$box=new h.Path.Circle({center:[e.x,e.y],radius:150}),t()},draw_big_project:function(e,t){return e.$box=new h.Path.Circle({center:[e.x,e.y],radius:70}),t()},draw_piscine:function(e,t){return e.$box=new h.Path.Rectangle({center:[e.x,e.y],size:new h.Size(180,60)}),t()},draw_label:function(e){var t,n,r,i,a,o;return r=function(e,t,n,r){return new h.Point([parseInt(n*Math.cos(r*Math.PI/180),10)+e,parseInt(n*Math.sin(r*Math.PI/180),10)+t])},n=function(e,t){return e.scale(e.bounds.width>t.width-10?100*(t.width-10)/e.bounds.width/100:1)},t=function(e,t,r){var i;return e.y+=5,i=new h.PointText({point:e,content:r.name,style:u[r.state].text}),n(i,t)},o=function(){switch(e.kind){case"first_internship":return[r(3e3,3e3,1e3,45),new h.Size(2e3,2e3)];case"second_internship":return[r(3e3,3e3,2200,45),new h.Size(4400,4400)];default:return[new h.Point(e.x,e.y),new h.Size(e.$box.getBounds())]}}(),i=o[0],a=o[1],p(e)&&(e.$box=new h.Path.Circle({center:i,radius:100,style:u[e.state]})),t(i,a,e)},select:function(e,t){return this.unselect().then(function(n){return function(){return l.hide(),1===e.length&&a.show(e[0].project_id),f.each(e,function(e){return e.selected=!0,d(e,!0)}),t?c.zoom_to(f.last(e).$box.position):void 0}}(this))},unselect:function(){return new Promise(function(e){return a.hide(),f.each(f.filter(i.projects,{selected:!0}),function(e){return e.selected=!1,d(e,!1)}),e()})}},f.assign(t,s)})}.call(this),function(){define("graph/zoom_handler",["require","exports","module","lodash","jquery","jquery-mousewheel","./data","./project","./description","./search","./help"],function(e,t,n){var r,i,a,o,s,l,u,c,d,p,h,f,_,m,v,g,y;return y=e("lodash"),r=e("jquery"),e("jquery-mousewheel"),i=e("./data"),s=e("./project"),a=e("./description"),l=e("./search"),o=e("./help"),_=null,v=!1,g=null,d=function(e,t,n){var r,i,a,o,s;return s=e.viewToProject(n),i=f(e,t),r=e.zoom/i,o=s.subtract(e.center),a=s.subtract(o.multiply(r)).subtract(e.center),e.zoom=i,t>0&&c(e,a),e.center=e.center.add(a)},f=function(e,t){var n,r,i;return n=1.08,i=h(e),r=p(e),0>t?e.zoom*n>r?r:e.zoom*n:t>0?e.zoom/n<i?i:e.zoom/n:e.zoom},h=function(e){return e.viewSize.height/e._project._activeLayer.getBounds().height},p=function(e){return 1.8},c=function(e,t){var n,r;return r=e.getBounds(),n=e._project._activeLayer.getBounds(),e.center.y+t.y<r.height/2&&(t.y=r.height/2-e.center.y),e.center.y+t.y+r.height/2>n.height&&(t.y=n.height-e.center.y-r.height/2),e.center.x+t.x<r.width/2&&(t.x=r.width/2-e.center.x),e.center.x+t.x+r.width/2>n.width&&(t.x=n.width-e.center.x-r.width/2),r.width>n.width&&(t.x=t.x+(r.width-n.width)/2),r.height>n.height?t.y=t.y+(r.height-n.height)/2:void 0},m=[],u={on_frame:function(){return y.each(m,function(e){return e()})},zoom_to:function(e,t){var n,r,i;return r=p(paper.view),i=t&&paper.view.zoom*t<r?paper.view.zoom*t:r,n=function(t){return function(){var r;return r=paper.view.zoom,r>=i?m=m.slice(m.indexOf(n),0):(i>r&&t.zoom_in(),t.changeCenter(paper.view,e.subtract(paper.view.center),.3))}}(this),m.push(n)},zoom_in:function(e){var t,n;return null==e&&(e=1.08),n=paper.view.zoom*e,t=p(paper.view),paper.view.zoom=n>t?t:n},zoom_out:function(){var e,t;return t=paper.view.zoom+paper.view.zoom*-.08,e=h(paper.view),paper.view.zoom=e>t?e:t},reset_zoom:function(e){return paper.view.center=e,paper.view.zoom=h(paper.view)},changeCenter:function(e,t,n){return t=t.multiply(n),c(e,t),e.center=e.center.add(t)},bind:function(e){return e.mousewheel(function(e){return function(t){return t.shiftKey?(e.changeCenter(paper.view,new paper.Point(t.deltaX,-t.deltaY),t.deltaFactor),t.preventDefault()):(_=new paper.Point(t.offsetX,t.offsetY),d(paper.view,-1*t.deltaY,_),t.preventDefault(),paper.view.draw())}}(this)),paper.view.onresize=function(e){return function(){return d(paper.view,0,_),paper.view.draw()}}(this),e.on("touchstart",function(e){return 2===e.originalEvent.touches.length?v=!0:void 0}),e.on("touchmove",function(e){return function(t){var n,r;return v?(r=t.originalEvent.touches,n=Math.sqrt((r[0].pageX-r[1].pageX)*(r[0].pageX-r[1].pageX)+(r[0].pageY-r[1].pageY)*(r[0].pageY-r[1].pageY)),g&&(n>g&&e.zoom_in(),g>n&&e.zoom_out()),g=n):void 0}}(this)),e.on("touchend",function(e){return v=!1,g=null})}},y.assign(t,u)})}.call(this),function(){define("graph/mouse_handler",["jquery","paper","./project","./search","./help","./data","./zoom_handler"],function(e,t,n,r,i,a,o){var s;return s=function(){function e(){}var s,l,u,c,d,p,h;return l=200,u=null,s=new Date,p=function(e){return this.projects_layer.contains(e.point)?document.body.style.cursor="pointer":document.body.style.cursor="default"},h=function(e){var c,d;return u=null,this.projects_layer.contains(e.point)?(d=_.filter(a.projects,function(t){return function(t){return t.$box.contains(e.point)}}(this)),n.select(d,new Date-s<l)):(new Date-s<l&&(c=new t.Point(e.event.offsetX,e.event.offsetY),o.zoom_to(t.view.viewToProject(c),3)),n.unselect()),s=new Date,i.hide(),r.hide()},d=function(e){var n,r;return n=e.point.subtract(u),r=-1*t.view.zoom/2,o.changeCenter(t.view,n,r)},c=function(e){return u=e.point},e.bind=function(e){return e.tool.onMouseDrag=d,e.tool.onMouseMove=p.bind(e),e.tool.onMouseUp=h.bind(e),e.tool.onMouseDown=c.bind(e)},e}()})}.call(this),function(){define("graph/cursus",["require","exports","module","lodash","jquery","./project","./description","./search","./help"],function(e,t,n){var r,i,a,o,s,l,u,c;return c=e("lodash"),r=e("jquery"),l=e("./project"),o=e("./description"),u=e("./search"),s=e("./help"),i=r("#graph_cursus"),a={show:function(){var e;if(!u.is_visible())return o.hide(),s.hide(),document.createEvent?(e=document.createEvent("MouseEvents"),e.initMouseEvent("mousedown",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i[0].dispatchEvent(e)):element.fireEvent?i.trigger("onmousedown"):void 0},toggle:function(){return this.is_visible()?void 0:this.show()},is_visible:function(){return i.is(":selected")}},c.assign(t,a)})}.call(this),function(){define("graph/key_handler",["require","exports","module","lodash","jquery","paper","./data","./project","./search","./description","./cursus","./help"],function(e,t,n){var r,i,a,o,s,l,u,c,d,p,h,f,_,m,v,g;return g=e("lodash"),r=e("jquery"),m=e("paper"),o=e("./data"),c=e("./project"),d=e("./search"),s=e("./description"),a=e("./cursus"),l=e("./help"),i=r('.search-input[name="query"]'),p={shift:!1,"+":!1,"-":!1,up:!1,down:!1,left:!1,right:!1},v=function(e){return e.event.target!==i[0]},h=function(){return c.unselect(),d.on_escape(),l.hide()},_=function(e){return v(e)?(g.isUndefined(p[e.key])||(p[e.key]=!1),"escape"===e.key?h():"h"===e.key||"?"===e.key?l.toggle():"s"===e.key||"/"===e.key?d.show():"c"===e.key?a.toggle():"enter"===e.key?s.click_on_link():void 0):void 0},f=function(e){return v(e)?g.isUndefined(p[e.key])?void 0:p[e.key]=!0:void 0},u={is_pressed:function(e){return p[e]},bind:function(e){return e.tool.onKeyUp=_,e.tool.onKeyDown=f}},g.assign(t,u)})}.call(this),function(){define("graph/animation_handler",["require","exports","module","lodash","paper","./key_handler","./zoom_handler"],function(e,t,n){var r,i,a,o,s,l,u;return u=e("lodash"),s=e("paper"),i=e("./key_handler"),a=e("./zoom_handler"),l=null,o=function(e){return i.is_pressed("shift")&&(i.is_pressed("up")&&a.changeCenter(s.view,l.set(0,-10),1),i.is_pressed("down")&&a.changeCenter(s.view,l.set(0,10),1),i.is_pressed("left")&&a.changeCenter(s.view,l.set(-10,0),1),i.is_pressed("right")&&a.changeCenter(s.view,l.set(10,0),1)),i.is_pressed("+")?a.zoom_in():i.is_pressed("-")&&a.zoom_out(),a.on_frame()},r={bind:function(){return l=new s.Point(0,0),s.view.onFrame=o}},u.assign(t,r)})}.call(this),function(){define("graph/link",["require","exports","module","lodash","paper","./colors","./data"],function(e,t,n){var r,i,a,o,s,l;return l=e("lodash"),s=e("paper"),r=e("./colors"),i=e("./data"),o=function(e,t){var n;return n=l.find(i.projects,"project_id",t.parent_id),{strokeWidth:10,strokeColor:n&&"done"===n.state?r[e.state].link:r.unavailable.link}},a={draw:function(e,t){return t.by?(e.activate(),t.$links=[],l.each(t.by,function(e){return t.$links.push(new s.Path({segments:e.points,style:o(t,e)}))})):void 0}},l.assign(t,a)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("graph/main",["jquery","paper","./grid","./zoom_handler","./mouse_handler","./key_handler","./animation_handler","./data","./project","./link","./description","./search","./help"],function(t,n,r,i,a,o,s,l,u,c,d,p,h){var f,m,v,g,y,w,b,k,j;return b=6e3,k=6e3,j=new n.Point(k/2,b/2),y=t(window),g=t(".main-navbar"),m=t(".view_ctn"),f=t("canvas#view"),v=t("#graph_cursus"),w=function(){function d(t){this.fetch_url=t,this.on_cursus_selector_change=e(this.on_cursus_selector_change,this),this.set_ctn_height=e(this.set_ctn_height,this),this.$canvas=f,this.$cursus_selector=v,this.set_ctn_height(),n.setup(f[0]),this.tool=new n.Tool,this.main_layer=n.project.activeLayer,this.links_layer=new n.Layer,this.internship_layer=new n.Layer,this.projects_layer=new n.Layer,r.draw(this.main_layer,k,b),this.bind(),v.trigger("change")}return d.prototype.set_ctn_height=function(){return m.height(y.height()-g.height())},d.prototype.populate=function(e){return new Promise(function(t){return function(n,r){return t.links_layer.removeChildren(),t.projects_layer.removeChildren(),t.internship_layer.removeChildren(),_.each(e,function(e){return c.draw(t.links_layer,e),u.draw(e,{project:t.projects_layer,internship:t.internship_layer})}),n()}}(this))},d.prototype.getData=function(e){return new Promise(function(n){return function(r,i){return t.ajax({url:n.fetch_url.replace("cursus_id",e),success:r,error:i})}}(this))},d.prototype.bind=function(){return v.on("change",this.on_cursus_selector_change),y.on("resize",this.set_ctn_height),i.bind(f),a.bind(this),o.bind(this),p.bind(this),h.bind(this),s.bind()},d.prototype.on_cursus_selector_change=function(e){return i.reset_zoom(j),this.getData(e.currentTarget.value).then(function(e){return function(t){return l.projects=t,e.populate(l.projects),e.main_layer.activate(),n.view.draw()}}(this))},d}()})}.call(this),define("graph",["graph/main"],function(e){return e}),function(){define("common/scale_team_users",["lodash","jquery","noty"],function(e,t,n){var r;return r=function(){function r(n){var r;r={selector:"data-scale-team",userId:t("body").attr("data-id"),publicChannelName:"global",queryEvent:"scale_team_user.checkin"},this.opts=e.extend(r,n),console.log("Boot stu"),this.ws=!1,"undefined"!=typeof dispatcher&&null!==dispatcher?(this.ws=dispatcher,this._bindWsHandler()):(console.warn("No websocket handler found :/"),this._bindAjaxHandler())}return r.prototype._bindWsHandler=function(){var e;return e=this.ws.subscribe(this.opts.publicChannelName),e.bind(this.opts.queryEvent,function(e){return function(t){return console.log("Checking event !",t),e._checkinFor(t.user_id,t.scale_team_id,t.login)}}(this))},r.prototype._bindAjaxHandler=function(){return console.log("Ajax fallback :'(")},r.prototype._checkinFor=function(e,r,i){var a;return a=t("[data-checkin-id='"+r+"-"+e+"']"),a.attr("data-checkin-present","true"),n({layout:"topRight",type:"success",text:""+i+" just checked in",timeout:4e3})},r.isOnScaleTeamPage=function(){return t("[data-scale-team]").length>0},r}()})}.call(this),define("vendor/nested_form_rjs",["jquery"],function(e){!function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var n=t.currentTarget,r=e(n).data("association"),i=e("#"+e(n).data("blueprint-id")),a=i.data("blueprint"),o=(e(n).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(/\[[a-z_]+\]$/,""),s=a.match(new RegExp("\\[([a-z_]+)\\]\\[new_"+r+"\\]"));if(s&&(o=o.replace(new RegExp("\\["+s[1]+"\\]\\[(new_)?\\d+\\]$"),"")),o)for(var l=o.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],u=o.match(/[0-9]+/g)||[],c=0;c<l.length;c++)u[c]&&(a=a.replace(new RegExp("(_"+l[c]+")_.+?_","g"),"$1_"+u[c]+"_"),a=a.replace(new RegExp("(\\["+l[c]+"\\])\\[.+?\\]","g"),"$1["+u[c]+"]"));var d=new RegExp("new_"+r,"g"),p=this.newId();a=e.trim(a.replace(d,p));var h=this.insertFields(a,r,n);return h.trigger({type:"nested:fieldAdded",field:h}).trigger({type:"nested:fieldAdded:"+r,field:h}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,n,r){var i=e(r).data("target");return i?e(t).appendTo(e(i)):e(t).insertBefore(r)},removeFields:function(t){var n=e(t.currentTarget),r=n.data("association"),i=n.prev("input[type=hidden]");i.val("1");var a=n.closest(".fields");return a.hide(),a.trigger({type:"nested:fieldRemoved",field:a}).trigger({type:"nested:fieldRemoved:"+r,field:a}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(e),function(e){e.fn.closestChild=function(t){if(t&&""!=t){var n=[];for(n.push(this);n.length>0;)for(var r=n.shift(),i=r.children(),a=0;a<i.length;++a){var o=e(i[a]);if(o.is(t))return o;n.push(o)}}return e()}}(e)}),function(){var e={}.hasOwnProperty,t=function(t,n){function r(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};require(["require","vendor"],function(e){return e(["common"],function(n){return e(["jquery","quests","project","graph","rangeslider","common/scale_team_users","vendor/nested_form_rjs"],function(r,i,a,o){var s;return new(s=function(n){function s(){return s.__super__.constructor.apply(this,arguments)}return t(s,n),s.prototype.ready=function(){var t;return r("select.select:not(.chosen)").each(function(){return r(this).val(r(this).find("option[selected='selected']").val())}),r("canvas.graph-canvas").length?(new o(r("canvas#view").data("fetch-url")),sessionStorage.getItem("seenHelp")||(r("#graph_help").show(),sessionStorage.setItem("seenHelp",!0))):new a,r(".scale-section-answers, .scale_team_feedback").length>0&&r('input[type="range"]').rangeslider({polyfill:!1}),t=e("common/scale_team_users"),t.isOnScaleTeamPage()&&new t,r("select#quest_kind").length>0?new i:void 0},s}(n))})})})}.call(this),define("application",function(){});