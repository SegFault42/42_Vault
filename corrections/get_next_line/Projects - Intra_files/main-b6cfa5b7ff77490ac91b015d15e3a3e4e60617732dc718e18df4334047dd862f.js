(function(){var t=[].slice,n=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1};define("components/cable/connection",[],function(){var e;return e=function(){function e(t){this.consumer=t,this.open()}return e.prototype.send=function(t){return this.isOpen()?(this.webSocket.send(JSON.stringify(t)),!0):!1},e.prototype.open=function(){return this.isState("open","connecting")?void 0:(this.webSocket=new WebSocket(this.consumer.url),this.installEventHandlers())},e.prototype.close=function(){var t;if(!this.isState("closed","closing"))return null!=(t=this.webSocket)?t.close():void 0},e.prototype.reopen=function(){return this.isOpen()?this.closeSilently(function(t){return function(){return t.open()}}(this)):this.open()},e.prototype.isOpen=function(){return this.isState("open")},e.prototype.isState=function(){var e,i;return e=1<=arguments.length?t.call(arguments,0):[],i=this.getState(),n.call(e,i)>=0},e.prototype.getState=function(){var t,n,e;for(t in WebSocket)if(n=WebSocket[t],n===(null!=(e=this.webSocket)?e.readyState:void 0))return t.toLowerCase();return null},e.prototype.closeSilently=function(t){null==t&&(t=function(){}),this.uninstallEventHandlers(),this.installEventHandler("close",t),this.installEventHandler("error",t);try{return this.webSocket.close()}finally{this.uninstallEventHandlers()}},e.prototype.installEventHandlers=function(){var t,n;n=[];for(t in this.events)n.push(this.installEventHandler(t));return n},e.prototype.installEventHandler=function(t,n){return null==n&&(n=this.events[t].bind(this)),this.webSocket.addEventListener(t,n)},e.prototype.uninstallEventHandlers=function(){var t,n;n=[];for(t in this.events)n.push(this.webSocket.removeEventListener(t));return n},e.prototype.events={message:function(t){var n,e,i;return i=JSON.parse(t.data),n=i.identifier,e=i.message,console.log("Received "+n+" - "+e),this.consumer.subscriptions.notify(n,"received",e)},open:function(){return this.consumer.subscriptions.reload()},close:function(){return this.consumer.subscriptions.notifyAll("disconnected")},error:function(){return this.consumer.subscriptions.notifyAll("disconnected"),this.closeSilently()}},e.prototype.toJSON=function(){return{state:this.getState()}},e}()})}).call(this),function(){define("components/cable/connection_monitor",[],function(){var t;return t=function(){function t(t){this.consumer=t,this.consumer.subscriptions.add(this),this.start()}var n,e,i;return t.prototype.identifier="_ping",t.prototype.pollInterval={min:2,max:30},t.prototype.staleThreshold={startedAt:4,pingedAt:8},t.prototype.connected=function(){return this.reset(),this.pingedAt=e()},t.prototype.received=function(){return this.pingedAt=e()},t.prototype.reset=function(){return this.reconnectAttempts=0},t.prototype.start=function(){return this.reset(),delete this.stoppedAt,this.startedAt=e(),this.poll()},t.prototype.stop=function(){return this.stoppedAt=e()},t.prototype.poll=function(){return setTimeout(function(t){return function(){return t.stoppedAt?void 0:(t.reconnectIfStale(),t.poll())}}(this),this.getInterval())},t.prototype.getInterval=function(){var t,e,i,o;return o=this.pollInterval,i=o.min,e=o.max,t=4*Math.log(this.reconnectAttempts+1),1e3*n(t,i,e)},t.prototype.reconnectIfStale=function(){return this.connectionIsStale()?(this.reconnectAttempts+=1,this.consumer.connection.reopen()):void 0},t.prototype.connectionIsStale=function(){return this.pingedAt?i(this.pingedAt)>this.staleThreshold.pingedAt:i(this.startedAt)>this.staleThreshold.startedAt},t.prototype.toJSON=function(){var t,n;return n=this.getInterval(),t=this.connectionIsStale(),{startedAt:this.startedAt,stoppedAt:this.stoppedAt,pingedAt:this.pingedAt,reconnectAttempts:this.reconnectAttempts,connectionIsStale:t,interval:n}},e=function(){return(new Date).getTime()},i=function(t){return(e()-t)/1e3},n=function(t,n,e){return Math.max(n,Math.min(e,t))},t}()})}.call(this),function(){define("components/cable/subscription",[],function(){var t;return t=function(){function t(t,e,i){this.subscriptions=t,null==e&&(e={}),this.identifier=JSON.stringify(e),n(this,i),this.subscriptions.add(this),this.consumer=this.subscriptions.consumer}var n;return t.prototype.perform=function(t,n){return null==n&&(n={}),n.action=t,this.send(n)},t.prototype.send=function(t){return this.consumer.send({command:"message",identifier:this.identifier,data:JSON.stringify(t)})},t.prototype.unsubscribe=function(){return this.subscriptions.remove(this)},n=function(t,n){var e,i;if(null!=n)for(e in n)i=n[e],t[e]=i;return t},t}()})}.call(this),function(){var t=[].slice;define("components/cable/subscriptions",["components/cable/subscription"],function(n){var e;return e=function(){function e(t){this.consumer=t,this.subscriptions=[]}return e.prototype.create=function(t,e){var i,o;return i=t,o="object"==typeof i?i:{channel:i},new n(this,o,e)},e.prototype.add=function(t){return this.subscriptions.push(t),this.notify(t,"initialized"),this.sendCommand(t,"subscribe")?this.notify(t,"connected"):void 0},e.prototype.reload=function(){var t,n,e,i,o;for(i=this.subscriptions,o=[],n=0,e=i.length;e>n;n++)t=i[n],this.sendCommand(t,"subscribe")?o.push(this.notify(t,"connected")):o.push(void 0);return o},e.prototype.remove=function(t){var n;return this.subscriptions=function(){var e,i,o,r;for(o=this.subscriptions,r=[],e=0,i=o.length;i>e;e++)n=o[e],n!==t&&r.push(n);return r}.call(this),this.findAll(t.identifier).length?void 0:this.sendCommand(t,"unsubscribe")},e.prototype.findAll=function(t){var n,e,i,o,r;for(o=this.subscriptions,r=[],e=0,i=o.length;i>e;e++)n=o[e],n.identifier===t&&r.push(n);return r},e.prototype.notifyAll=function(){var n,e,i,o,r,s,c;for(e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],s=this.subscriptions,c=[],o=0,r=s.length;r>o;o++)i=s[o],c.push(this.notify.apply(this,[i,e].concat(t.call(n))));return c},e.prototype.notify=function(){var n,e,i,o,r,s,c;for(i=arguments[0],e=arguments[1],n=3<=arguments.length?t.call(arguments,2):[],o="string"==typeof i?this.findAll(i):[i],c=[],r=0,s=o.length;s>r;r++)i=o[r],c.push("function"==typeof i[e]?i[e].apply(i,n):void 0);return c},e.prototype.sendCommand=function(t,n){var e;return e=t.identifier,e===Cable.PING_IDENTIFIER?this.consumer.connection.isOpen():this.consumer.send({command:n,identifier:e})},e.prototype.toJSON=function(){var t,n,e,i,o;for(i=this.subscriptions,o=[],n=0,e=i.length;e>n;n++)t=i[n],o.push(t.identifier);return o},e}()})}.call(this),function(){define("components/cable/consumer",["components/cable/connection","components/cable/connection_monitor","components/cable/subscriptions","components/cable/subscription"],function(t,n,e){var i;return i=function(){function i(i){this.url=i,this.subscriptions=new e(this),this.connection=new t(this),this.connectionMonitor=new n(this)}return i.prototype.send=function(t){return this.connection.send(t)},i.prototype.inspect=function(){return JSON.stringify(this,null,2)},i.prototype.toJSON=function(){return{url:this.url,subscriptions:this.subscriptions,connection:this.connection,connectionMonitor:this.connectionMonitor}},i}()})}.call(this),function(){define("components/cable",["components/cable/consumer"],function(t){return this.Cable={PING_IDENTIFIER:"_ping",createConsumer:function(n){return new t(n)}}})}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};define("components/websockets/manager",["jquery","components/cable","Logger"],function(n,e){var i;return i=function(){function i(i){this._bindAppearance=t(this._bindAppearance,this),this.addHandler=t(this.addHandler,this);var o;is_beta()&&console.group("Websocket connection"),o={websocketUrl:n("body").attr("data-url"),userId:n("body").attr("data-id"),publicChannelName:"global",handlers:[]},this.opts=_.extend(o,i),is_beta()&&(this.dispatcher=e.createConsumer("wss://"+this.opts.websocketUrl+"websocket"),this.logged=!1,this.retries=0,window.dispatcher=this.dispatcher,window.manager=this)}return i.prototype._bindPublicRoutes=function(){return _.each(this.opts.handlers,function(t){return function(n){return n.bindPublicHandlers?n.bindPublicHandlers(t.dispatcher):void 0}}(this))},i.prototype.addHandler=function(t){return t.bindHandlers&&t.bindHandlers(this.dispatcher),t.bindPublicHandlers?t.bindPublicHandlers(this.dispatcher):void 0},i.prototype._bindAppearance=function(){return this.dispatcher.subscriptions.create("AppearanceChannel",{connected:function(){return console.log("Subscribed to appareance")},appear:function(){return this.perform("appear",{appearing_on:this.appearingOn()})},away:function(){return this.perform("away")},appearingOn:function(){return n(".users-counter").html("LAAAAA")}})},i}()})}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}};define("components/base",["jquery"],function(n){var e;return e=function(){function e(n,e){this.name=n,this.root=e,this.bindHandlers=t(this.bindHandlers,this),this._onProgress=t(this._onProgress,this),this.data=[],this._renderTemplate(),this.verbose=is_beta(),this.bindEvents=["new","update","progress"],this.counterClass=".labeled",this.dispatcher=null!=window.dispatcher}return e.prototype._channelNameFor=function(t){return""+this.name+"."+t},e.prototype._renderTemplate=function(){return""},e.prototype.bind=function(t){switch(t){case"new":return this._onNew;case"update":return this._onUpdate;case"progress":return this._onProgress;default:return console.warn("Event "+t+" can't be binded on component..."),function(t){return console.warn("empty function "+t)}}},e.prototype._onNew=function(t){return log("[new] requested !",t)},e.prototype._onUpdate=function(t){return log("[update] requested !",t)},e.prototype._onProgress=function(t){return this.verbose?log("["+this.name+"] Progress "+this.name+" requested !",t):void 0},e.prototype.bindHandlers=function(t,n){var e,i,o,r,s;for(null==n&&(n="?"),r=this.bindEvents,s=[],i=0,o=r.length;o>i;i++)e=r[i],s.push(t.bind(this._channelNameFor(e),this.bind(e)));return s},e.prototype.bindPublicHandlers=function(t){return this.dispatcher=t,this.bindHandlers(t.subscribe("global"),"global")},e.prototype._incrementCounters=function(){var t;return null!=this.root&&n(this.root).find(this.counterClass).length>0?(t=parseInt(n(this.root).find(this.counterClass).text()),n(this.root).find(this.counterClass).html(t+1),n(this.root).find(this.counterClass).attr("data-counter-count",t+1)):void 0},e.prototype._resetCounters=function(){return null!=this.root&&n(this.root).find(this.counterClass).length>0?(n(this.root).find(this.counterClass).html(0),n(this.root).find(this.counterClass).attr("data-counter-count",0)):void 0},e}()})}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function i(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};define("components/drop_component",["jquery","components/base","common/data_date"],function(n,i,o){var r,s;return s=new o,r=function(i){function o(e,i){this._updateItem=t(this._updateItem,this),this._addItem=t(this._addItem,this),this._onProgress=t(this._onProgress,this),this._onUpdate=t(this._onUpdate,this),this._onNew=t(this._onNew,this),this._renderTemplate=t(this._renderTemplate,this),o.__super__.constructor.call(this,e,i),this.containerSelector=".notifications-container",this.url=n(this.containerSelector).attr("data-notifications-url"),this.data=[],this._handleEvents(),is_beta()&&this._askForNotifications(function(t){return console.info("Notifications")}),this.render()}return e(o,i),o.prototype.render=function(){return this.data=_.sortBy(this.data,function(t){return t.updated_at||t.text||t.progress}).reverse(),n(this.containerSelector).html(this._renderTemplate()),s&&s._updateAll(),this._position()},o.prototype._renderTemplate=function(){return this.template='<header class="notifications--header">\n  <span>notifications</span>\n  <a href="'+this.url+'">See all notifications</a>\n</header>\n<ul class="menu-drop-list">'+_.map(this.data,this._renderCellTemplate).join("")+"</ul>"},o.prototype._renderCellTemplate=function(t){return'<li class="menu-drop-item dancer '+(t.read?"read":"unread")+'">\n  <a href="'+(t.link||"#")+'">'+(t.image?'<div class="menu-drop-image full-bg square-s" style="background-image: url('+t.image+')"></div>':"")+('    <div class="menu-drop-content">\n    '+(t.title?'<div class="menu-drop-title">'+t.title+"</div>":"")+"\n    "+(t.text?'<div class="menu-drop-text">'+t.text+"</div>":"")+"\n    "+(t.updated_at?'<span class="menu-drop-created" data-short-date="'+t.updated_at+'">'+t.updated_at+"</span>":"")+"\n    "+(t.progress?'<div class="menu-drop-progress"><div class="progress"><div class="progress-bar" style="width:'+t.progress+'%"></div></div></div>':"")+"\n    </div>\n  </a>\n</li>")},o.prototype._onNew=function(t){return this.verbose&&log("["+this.name+"] New "+this.name+" requested !",t),this._addItem(t),is_beta()?this._createNotification(t):void 0},o.prototype._onUpdate=function(t){return this.verbose&&log("["+this.name+"] Update "+this.name+" requested !",t),this._updateItem(t)},o.prototype._onProgress=function(t){var n;return this.verbose&&log("["+this.name+"] Progress "+this.name+" requested !",t),t.progress?(n=_.findWhere(_notifications.read,{concern:t.concern}),n?(n.progress=t.progress,this._updateItem(t)):void 0):void 0},o.prototype._askForNotifications=function(t){return"granted"===Notification.permission?!0:("denied"!==Notification.permission&&Notification.requestPermission(t),"granted"===Notification.permission)},o.prototype._createNotification=function(t){var n,e;return n=""+t.title+": "+t.text,"Notification"in window?"granted"===Notification.permission?(e=new Notification(n),e.onClick=function(){return document.location=t.link}):"denied"!==Notification.permission&&this._askForNotifications(function(i){return function(){return e=new Notification(n),e.onClick=function(){return document.location=t.link}}}(this)):console.warn("This browser does not support desktop notification"),"granted"===Notification.permission},o.prototype._addItem=function(t){return t=this._filterObject(t),t.onCurrentPage()||(this.data.unshift(t),this.render(),t.read)?void 0:this._incrementCounters()},o.prototype._updateItem=function(t){var n;return t.read=!1,t=this._filterObject(t),!t.onCurrentPage()&&(n=_.findWhere(this.data,{title:t.title,concern:t.concern}),n&&(this.data=_.reject(this.data,{title:t.title,concern:t.concern}),this.data.unshift(t),this.render(),n&&n.read))?this._incrementCounters():void 0},o.prototype._onOpen=function(){return n(this.containerSelector).addClass("open"),this.data.length>0?this.readingTimeout=setTimeout(function(t){return function(){var e,i,o,r;for(r=t.data,i=0,o=r.length;o>i;i++)e=r[i],e.read=!0;return n(""+t.containerSelector+" .unread").addClass("read").removeClass("unread"),t._resetCounters(),t.readingTimeout=!1,t._markAllAsRead()}}(this),1e3):void 0},o.prototype._onClose=function(){return n(this.containerSelector).removeClass("open"),this.readingTimeout?clearTimeout(this.readingTimeout):void 0},o.prototype._markAllAsRead=function(){return n.signedAjax({url:""+this.url+"/read_all",method:"POST"}).done(function(t){return log("Sucessfully read all !",t)})},o.prototype._handleEvents=function(){return n(document).on("click",this.root,function(t){return function(e){return n(t.containerSelector).hasClass("open")?t._onClose():t._onOpen(),e.stopImmediatePropagation(),!1}}(this)),n(document).on("click",function(t){return function(){return n(t.containerSelector).removeClass("open")}}(this))},o.prototype._position=function(){var t,e;return e=n(".main-navbar").height(),t=n(this.root).offset().left-265,n(this.containerSelector).css({top:e,left:t})},o.prototype._filterObject=function(t){return t.read||(t.read=!1),t.progress||(t.progress=!1),t.image&&void 0!==t.image.url&&(t.image=t.image.url),t.markAsRead=function(n){return function(){return n.dispatcher?n.dispatcher.trigger("notifications.read",{concern:t.concern,title:t.title}):void 0}}(this),t.onCurrentPage=function(){return t.concern&&n("[data-concern='"+this.concern+"']").length>0?(this.markAsRead(),!0):!1},t},o}(i)})}.call(this),function(){var t=function(t,n){return function(){return t.apply(n,arguments)}},n={}.hasOwnProperty,e=function(t,e){function i(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};define("components/friendship",["jquery","components/drop_component"],function(n,i){var o;return o=function(i){function o(){this._onNew=t(this._onNew,this),n("[data-friendship-drop]").length&&(o.__super__.constructor.call(this,"friendship","[data-friendship-drop]"),this._bindFriendshipActions())}return e(o,i),o.prototype.ACCEPT_URL="http://localhost:8000/friends/<%= id %>",o.prototype.DECLINE_URL="http://localhost:8000/friends/<%= id %>/ignore",o.prototype.ACCEPTED_MESSAGE='<span class="icon-check"></span> Invitation accepted',o.prototype.DECLINED_MESSAGE='<span class="icon-ban"></span> Invitation declined',o.prototype._renderCellTemplate=function(t){return'<li class="menu-drop-item">\n  <div class="menu-drop-image full-bg square-s rounded" style="background-image: url(https://cdn.intra.42.fr/userprofil/'+t.login+'.jpg)"></div>\n  <div class="menu-drop-name">'+t.login+'</div>\n  <div class="menu-drop-actions">\n    <a href="#" data-friendship-accept="'+t.id+'"><span class="icon-check-circle-o"></span></a>\n    <a href="#" data-friendship-decline="'+t.id+'"><span class="icon-times-circle-o"></span></a>\n  </div>\n</li>'},o.prototype._bindFriendshipActions=function(){var t;return t=this,n("[data-friendship-accept]").click(function(){var e,i;return i=_.template(t.ACCEPT_URL)({id:n(this).attr("data-friendship-accept")}),e=n(this).parent().parent(),console.log("click ("+i+") aaaaand..."),n.ajax({url:i,data:{_method:"put"},method:"POST",success:function(){return console.log("request"),n(e).html(t.ACCEPTED_MESSAGE)}})}),n("[data-friendship-decline]").click(function(){var e,i;return i=_.template(t.DECLINE_URL)({id:n(this).attr("data-friendship-decline")}),e=n(this).parent().parent(),n.ajax({url:i,data:{_method:"delete"},method:"POST",success:function(){return n(e).html(t.DECLINED_MESSAGE)}})})},o.prototype._onNew=function(t){return console.log("newFriendship requested !",t),this.data.push(t),this.render(),this._bindFriendshipActions(),this._incrementCounters()},o}(i)})}.call(this),function(){var t={}.hasOwnProperty,n=function(n,e){function i(){this.constructor=n}for(var o in e)t.call(e,o)&&(n[o]=e[o]);return i.prototype=e.prototype,n.prototype=new i,n.__super__=e.prototype,n};define("components/notification",["jquery","components/drop_component"],function(t,e){var i;return i=function(e){function i(){t("[data-notification-drop]").length?(i.__super__.constructor.call(this,"notification","[data-notification-drop]"),t(".dropdown").on("click",function(){return t(".notifications-container.open").removeClass("open")}),t("[data-notification-drop]").on("click",function(){return t(".dropdown.open").removeClass("open")}),this.manageExistingNotifications()):console.error("[Notification] Unable to find notifiable aera")}return n(i,e),i.prototype.manageExistingNotifications=function(){var t,n,e,i,o,r,s,c;if("undefined"!=typeof _notifications&&null!==_notifications){for(r=_notifications.unread,n=0,i=r.length;i>n;n++)t=r[n],this._addItem(t);for(s=_notifications.read,c=[],e=0,o=s.length;o>e;e++)t=s[e],c.push(this._addItem(t));return c}},i}(e)})}.call(this),function(){define("components/main",["require","jquery","components/websockets/manager","components/base","components/drop_component","components/friendship","components/notification"],function(t,n){var e,i,o,r;return r=t("components/websockets/manager"),i=t("components/friendship"),o=t("components/notification"),e=t("common/data_date"),this.components=[],n("[data-friendship-drop]").length&&this.components.push(this.friendship=new i),this.components.push(this.notification=new o),new r({handlers:this.components})})}.call(this),define("components",["components/main"],function(t){return t});